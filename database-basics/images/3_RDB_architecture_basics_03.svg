<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- 定義 -->
  <defs>
    <linearGradient id="appGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dbGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="tcpGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ipGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ethGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#30cfd0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#330867;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="0" dy="3" stdDeviation="4" flood-opacity="0.2"/>
    </filter>
  </defs>
  
  <!-- 背景 -->
  <rect width="800" height="600" fill="#f8f9fa"/>
  
  <!-- タイトル -->
  <text x="400" y="40" text-anchor="middle" fill="#2c3e50" font-size="26" font-weight="bold">
    データベース通信プロトコルスタック
  </text>
  
  <!-- クライアント側スタック -->
  <g transform="translate(100, 100)">
    <text x="125" y="-10" text-anchor="middle" font-size="18" fill="#2c3e50" font-weight="bold">
      クライアント
    </text>
    
    <!-- アプリケーション層 -->
    <rect width="250" height="60" fill="url(#appGrad)" rx="10" filter="url(#shadow)"/>
    <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
      アプリケーション
    </text>
    <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
      SQLクエリ生成・結果処理
    </text>
    
    <!-- DB接続ライブラリ層 -->
    <g transform="translate(0, 80)">
      <rect width="250" height="60" fill="url(#dbGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        DB接続ライブラリ
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        MySQL/PostgreSQLプロトコル
      </text>
    </g>
    
    <!-- TCP層 -->
    <g transform="translate(0, 160)">
      <rect width="250" height="60" fill="url(#tcpGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        TCP
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        信頼性のある通信・ポート3306等
      </text>
    </g>
    
    <!-- IP層 -->
    <g transform="translate(0, 240)">
      <rect width="250" height="60" fill="url(#ipGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        IP
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        パケットルーティング
      </text>
    </g>
    
    <!-- イーサネット層 -->
    <g transform="translate(0, 320)">
      <rect width="250" height="60" fill="url(#ethGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        イーサネット
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        物理的なデータ転送
      </text>
    </g>
  </g>
  
  <!-- サーバー側スタック -->
  <g transform="translate(450, 100)">
    <text x="125" y="-10" text-anchor="middle" font-size="18" fill="#2c3e50" font-weight="bold">
      サーバー
    </text>
    
    <!-- データベースエンジン層 -->
    <rect width="250" height="60" fill="url(#appGrad)" rx="10" filter="url(#shadow)"/>
    <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
      データベースエンジン
    </text>
    <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
      SQL解析・実行・結果生成
    </text>
    
    <!-- DB通信層 -->
    <g transform="translate(0, 80)">
      <rect width="250" height="60" fill="url(#dbGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        DB通信プロトコル
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        認証・コマンド処理
      </text>
    </g>
    
    <!-- TCP層 -->
    <g transform="translate(0, 160)">
      <rect width="250" height="60" fill="url(#tcpGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        TCP
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        接続管理・データ送受信
      </text>
    </g>
    
    <!-- IP層 -->
    <g transform="translate(0, 240)">
      <rect width="250" height="60" fill="url(#ipGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        IP
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        アドレス管理
      </text>
    </g>
    
    <!-- イーサネット層 -->
    <g transform="translate(0, 320)">
      <rect width="250" height="60" fill="url(#ethGrad)" rx="10" filter="url(#shadow)"/>
      <text x="125" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">
        イーサネット
      </text>
      <text x="125" y="45" text-anchor="middle" fill="white" font-size="12">
        ネットワークインターフェース
      </text>
    </g>
  </g>
  
  <!-- 通信の流れを示す矢印 -->
  <g>
    <!-- 双方向矢印 -->
    <defs>
      <marker id="arrowLeft" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M10,0 L10,6 L0,3 z" fill="#34495e" />
      </marker>
      <marker id="arrowRight" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L10,3 z" fill="#34495e" />
      </marker>
    </defs>
    
    <!-- アプリケーション層 -->
    <line x1="350" y1="130" x2="450" y2="130" stroke="#34495e" stroke-width="3" marker-start="url(#arrowLeft)" marker-end="url(#arrowRight)" opacity="0.6"/>
    
    <!-- DB層 -->
    <line x1="350" y1="210" x2="450" y2="210" stroke="#34495e" stroke-width="3" marker-start="url(#arrowLeft)" marker-end="url(#arrowRight)" opacity="0.6"/>
    
    <!-- TCP層 -->
    <line x1="350" y1="290" x2="450" y2="290" stroke="#34495e" stroke-width="3" marker-start="url(#arrowLeft)" marker-end="url(#arrowRight)" opacity="0.6"/>
    
    <!-- IP層 -->
    <line x1="350" y1="370" x2="450" y2="370" stroke="#34495e" stroke-width="3" marker-start="url(#arrowLeft)" marker-end="url(#arrowRight)" opacity="0.6"/>
    
    <!-- イーサネット層 -->
    <line x1="350" y1="450" x2="450" y2="450" stroke="#34495e" stroke-width="3" marker-start="url(#arrowLeft)" marker-end="url(#arrowRight)" opacity="0.6"/>
  </g>
  
  <!-- 説明テキスト -->
  <g transform="translate(100, 520)">
    <text x="0" y="0" font-size="14" fill="#2c3e50" font-weight="bold">ローカル接続の場合:</text>
    <text x="0" y="20" font-size="12" fill="#7f8c8d">• Unix Domain Socket（Linux/Unix）</text>
    <text x="0" y="40" font-size="12" fill="#7f8c8d">• Named Pipe（Windows）</text>
    <text x="0" y="60" font-size="12" fill="#7f8c8d">• TCP/IPスタックをバイパスして高速通信</text>
  </g>
  
  <g transform="translate(450, 520)">
    <text x="0" y="0" font-size="14" fill="#2c3e50" font-weight="bold">セキュア接続の場合:</text>
    <text x="0" y="20" font-size="12" fill="#7f8c8d">• SSL/TLS暗号化層が追加</text>
    <text x="0" y="40" font-size="12" fill="#7f8c8d">• 証明書による認証</text>
    <text x="0" y="60" font-size="12" fill="#7f8c8d">• パフォーマンスへの影響あり</text>
  </g>
</svg>