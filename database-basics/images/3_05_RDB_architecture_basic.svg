<svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="900" height="600" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
    ストレージエンジンの構造と機能
  </text>
  
  <!-- Storage Engine Container -->
  <rect x="50" y="60" width="800" height="450" rx="15" fill="#2c3e50" stroke="#34495e" stroke-width="3"/>
  <text x="450" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
    ストレージエンジン
  </text>
  
  <!-- 1. Physical Structure Management -->
  <g id="physical-structure">
    <rect x="80" y="110" width="180" height="160" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
    <text x="170" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
      物理構造管理
    </text>
    <text x="170" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">
      テーブル・インデックス構造
    </text>
    
    <!-- B+ Tree structure -->
    <rect x="90" y="165" width="70" height="40" rx="5" fill="white" stroke="#2980b9"/>
    <text x="125" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#3498db">
      B+ツリー
    </text>
    <text x="125" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#3498db">
      インデックス構造
    </text>
    <text x="125" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#3498db">
      高速検索
    </text>
    
    <!-- Heap structure -->
    <rect x="170" y="165" width="70" height="40" rx="5" fill="white" stroke="#2980b9"/>
    <text x="205" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#3498db">
      ヒープ
    </text>
    <text x="205" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#3498db">
      テーブルデータ
    </text>
    <text x="205" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#3498db">
      行データ格納
    </text>
    
    <!-- Page management -->
    <rect x="90" y="215" width="150" height="25" rx="3" fill="#ffffff40" stroke="white"/>
    <text x="165" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
      ページ単位での効率的管理
    </text>
    
    <!-- Functions -->
    <text x="90" y="250" font-family="Arial, sans-serif" font-size="9" fill="white">
      • データの物理配置最適化
    </text>
    <text x="90" y="265" font-family="Arial, sans-serif" font-size="9" fill="white">
      • インデックス構造の維持
    </text>
  </g>
  
  <!-- 2. Transaction Processing -->
  <g id="transaction-processing">
    <rect x="280" y="110" width="180" height="160" rx="10" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
    <text x="370" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
      トランザクション処理
    </text>
    <text x="370" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">
      ロック・ロールバック・コミット
    </text>
    
    <!-- Lock mechanism -->
    <rect x="290" y="165" width="50" height="35" rx="5" fill="white" stroke="#c0392b"/>
    <text x="315" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#e74c3c">
      ロック
    </text>
    <text x="315" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#e74c3c">
      排他制御
    </text>
    <text x="315" y="197" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#e74c3c">
      同時実行
    </text>
    
    <!-- Rollback mechanism -->
    <rect x="350" y="165" width="50" height="35" rx="5" fill="white" stroke="#c0392b"/>
    <text x="375" y="177" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#e74c3c">
      ロールバック
    </text>
    <text x="375" y="187" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#e74c3c">
      変更取消
    </text>
    <text x="375" y="197" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#e74c3c">
      一貫性維持
    </text>
    
    <!-- Commit mechanism -->
    <rect x="410" y="165" width="40" height="35" rx="5" fill="white" stroke="#c0392b"/>
    <text x="430" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#e74c3c">
      コミット
    </text>
    <text x="430" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#e74c3c">
      変更確定
    </text>
    
    <!-- ACID properties -->
    <rect x="290" y="210" width="160" height="30" rx="3" fill="#ffffff40" stroke="white"/>
    <text x="370" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="white">
      ACID特性の保証
    </text>
    <text x="370" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">
      原子性・一貫性・独立性・永続性
    </text>
    
    <!-- Functions -->
    <text x="290" y="255" font-family="Arial, sans-serif" font-size="9" fill="white">
      • 同時実行制御
    </text>
    <text x="290" y="265" font-family="Arial, sans-serif" font-size="9" fill="white">
      • データ整合性維持
    </text>
  </g>
  
  <!-- 3. Data Persistence -->
  <g id="data-persistence">
    <rect x="480" y="110" width="180" height="160" rx="10" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
    <text x="570" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
      データ永続化
    </text>
    <text x="570" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">
      ディスクへの安全な書き込み
    </text>
    
    <!-- Buffer to disk flow -->
    <rect x="490" y="165" width="60" height="30" rx="5" fill="white" stroke="#8e44ad"/>
    <text x="520" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#9b59b6">
      バッファ
    </text>
    <text x="520" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#9b59b6">
      メモリ内
    </text>
    
    <!-- Arrow -->
    <path d="M 555 180 L 575 180 L 570 175 M 575 180 L 570 185" stroke="white" stroke-width="2" fill="none"/>
    
    <rect x="580" y="165" width="60" height="30" rx="5" fill="white" stroke="#8e44ad"/>
    <text x="610" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#9b59b6">
      ディスク
    </text>
    <text x="610" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#9b59b6">
      永続化
    </text>
    
    <!-- Write strategies -->
    <rect x="490" y="205" width="70" height="25" rx="3" fill="#ffffff40" stroke="white"/>
    <text x="525" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">
      同期書き込み
    </text>
    <text x="525" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">
      (安全性重視)
    </text>
    
    <rect x="570" y="205" width="70" height="25" rx="3" fill="#ffffff40" stroke="white"/>
    <text x="605" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">
      非同期書き込み
    </text>
    <text x="605" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">
      (性能重視)
    </text>
    
    <!-- Functions -->
    <text x="490" y="250" font-family="Arial, sans-serif" font-size="9" fill="white">
      • データ損失防止
    </text>
    <text x="490" y="265" font-family="Arial, sans-serif" font-size="9" fill="white">
      • 書き込み性能最適化
    </text>
  </g>
  
  <!-- 4. Crash Recovery -->
  <g id="crash-recovery">
    <rect x="680" y="110" width="140" height="160" rx="10" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
    <text x="750" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
      クラッシュリカバリ
    </text>
    <text x="750" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">
      WAL・整合性維持
    </text>
    
    <!-- WAL mechanism -->
    <rect x="690" y="165" width="120" height="35" rx="5" fill="white" stroke="#e67e22"/>
    <text x="750" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#f39c12">
      Write-Ahead Logging
    </text>
    <text x="750" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#f39c12">
      ログ先行書き込み
    </text>
    <text x="750" y="197" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#f39c12">
      復旧保証
    </text>
    
    <!-- Recovery process -->
    <rect x="690" y="210" width="50" height="25" rx="3" fill="#ffffff40" stroke="white"/>
    <text x="715" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">
      Redo
    </text>
    <text x="715" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">
      再実行
    </text>
    
    <rect x="750" y="210" width="50" height="25" rx="3" fill="#ffffff40" stroke="white"/>
    <text x="775" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">
      Undo
    </text>
    <text x="775" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">
      取り消し
    </text>
    
    <!-- Functions -->
    <text x="690" y="250" font-family="Arial, sans-serif" font-size="9" fill="white">
      • 障害からの自動復旧
    </text>
    <text x="690" y="265" font-family="Arial, sans-serif" font-size="9" fill="white">
      • データ整合性保証
    </text>
  </g>
  
  <!-- Data Flow Arrows -->
  <g id="data-flow">
    <!-- Between modules -->
    <path d="M 260 190 L 280 190" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead-gray)"/>
    <path d="M 460 190 L 480 190" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead-gray)"/>
    <path d="M 660 190 L 680 190" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead-gray)"/>
    
    <!-- Return arrows -->
    <path d="M 280 210 L 260 210" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead-gray)"/>
    <path d="M 480 210 L 460 210" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead-gray)"/>
    <path d="M 680 210 L 660 210" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead-gray)"/>
  </g>
  
  <!-- Storage Layer -->
  <rect x="80" y="300" width="740" height="80" rx="10" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
  <text x="450" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    物理ストレージ層
  </text>
  <text x="450" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    ディスク上のファイルシステム
  </text>
  
  <!-- Storage components -->
  <rect x="100" y="350" width="120" height="20" rx="3" fill="white" stroke="#2c3e50"/>
  <text x="160" y="362" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#34495e">
    データファイル
  </text>
  
  <rect x="240" y="350" width="120" height="20" rx="3" fill="white" stroke="#2c3e50"/>
  <text x="300" y="362" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#34495e">
    インデックスファイル
  </text>
  
  <rect x="380" y="350" width="120" height="20" rx="3" fill="white" stroke="#2c3e50"/>
  <text x="440" y="362" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#34495e">
    ログファイル
  </text>
  
  <rect x="520" y="350" width="120" height="20" rx="3" fill="white" stroke="#2c3e50"/>
  <text x="580" y="362" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#34495e">
    設定ファイル
  </text>
  
  <rect x="660" y="350" width="120" height="20" rx="3" fill="white" stroke="#2c3e50"/>
  <text x="720" y="362" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#34495e">
    一時ファイル
  </text>
  
  <!-- Arrows to storage -->
  <path d="M 170 270 L 170 300" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead-blue)"/>
  <path d="M 370 270 L 370 300" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <path d="M 570 270 L 570 300" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead-purple)"/>
  <path d="M 750 270 L 750 300" stroke="#f39c12" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
  
  <!-- Key Points -->
  <rect x="80" y="400" width="740" height="90" rx="10" fill="#2c3e50" stroke="#34495e" stroke-width="2"/>
  <text x="450" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    ストレージエンジンの重要な役割
  </text>
  
  <g id="key-points">
    <circle cx="110" cy="445" r="8" fill="#3498db"/>
    <text x="110" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">
      1
    </text>
    <text x="130" y="450" font-family="Arial, sans-serif" font-size="11" fill="white">
      データの物理配置を最適化して高速アクセスを実現
    </text>
    
    <circle cx="110" cy="465" r="8" fill="#e74c3c"/>
    <text x="110" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">
      2
    </text>
    <text x="130" y="470" font-family="Arial, sans-serif" font-size="11" fill="white">
      ACID特性を保証してデータの整合性を維持
    </text>
    
    <circle cx="460" cy="445" r="8" fill="#9b59b6"/>
    <text x="460" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">
      3
    </text>
    <text x="480" y="450" font-family="Arial, sans-serif" font-size="11" fill="white">
      データ損失を防ぐ安全な永続化機能
    </text>
    
    <circle cx="460" cy="465" r="8" fill="#f39c12"/>
    <text x="460" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">
      4
    </text>
    <text x="480" y="470" font-family="Arial, sans-serif" font-size="11" fill="white">
      障害時の自動復旧でシステムの可用性を確保
    </text>
  </g>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead-blue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#3498db"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e74c3c"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#9b59b6"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f39c12"/>
    </marker>
    <marker id="arrowhead-gray" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#7f8c8d"/>
    </marker>
  </defs>
</svg>