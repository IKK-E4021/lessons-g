# 2. データベースの種類と選択

# はじめに

なぜ、私たちは様々なデータベースについて学ぶ必要があるのでしょうか？

現代のアプリケーション開発において、データはシステムの「心臓」です。そして、最適なデータベースを選ぶことは、建物の「基礎」を選ぶことに似ています。

もし選択を誤れば、システムが遅くなったり、拡張が困難になったり、扱いたいデータをうまく格納できなかったりする可能性があります。

この章では、主要なデータベースの種類とその特徴を学び、適材適所でデータベースを選択し、堅牢でスケーラブルなシステムを構築するための判断力を養います。

# 2.1. リレーショナルデータベース（RDB）の概要

## 2.1.1 RDBとは？
<img width="824" height="580" alt="スクリーンショット 2025-07-16 2 09 03" src="https://github.com/user-attachments/assets/51117671-d30c-4ff6-8f85-7e23c27f21c6" />

- 行と列からなる表形式でデータを管理するデータベース
- Excelの表をイメージすると分かりやすいです
- SQL（Structured Query Language）という言語でデータを操作します

## 2.1.2 特徴
<img width="828" height="552" alt="スクリーンショット 2025-07-16 2 09 39" src="https://github.com/user-attachments/assets/1f0a0af7-eb54-4050-ae55-cc6c30915af1" />

- データの整合性を保証 (ACID特性)
  - Atomicity (原子性): トランザクションは全て成功 or 全て失敗
  - Consistency (一貫性): データは常に正しい状態を保つ
  - Isolation (独立性): 複数の処理が互いに影響しない
  - Durability (永続性): 一度完了した処理は失われない
- 事前に厳密なスキーマ（データの構造）を定義する必要がある


# 2.2. NoSQLデータベースの紹介

## 2.2.1 NoSQLとは？
"Not Only SQL" の略。RDB以外のデータベースの総称

## 2.2.2 登場背景
- インターネットの普及による爆発的なデータ量の増加（ビッグデータ）
- SNS、IoTなど、多様な形式のデータを扱う必要性が生まれた

## RDBとの大きな違い
<img width="665" height="579" alt="スクリーンショット 2025-07-16 2 13 39" src="https://github.com/user-attachments/assets/5f8873f9-808c-4ffd-9f4c-52ebc892f6ca" />

- スキーマが柔軟（スキーマレス）: 事前に厳密な構造を決めなくてもデータを保存できる
- 水平分散（スケールアウト）が得意: サーバーの台数を増やすことで性能を向上させやすい


# 2.3. NoSQLデータベースの種類

## 2.3.1 ドキュメント型

### 概要
JSONやXMLのような、構造を持った「ドキュメント」をそのまま格納するデータベース。各ドキュメントは自己完結しており、RDBのように複数のテーブルに分割して格納する必要がありません。

### 特徴
- スキーマレスで柔軟なデータ構造に対応できるため、開発途中の仕様変更に強い
- ドキュメント単位での読み書きが得意
- Webアプリケーションでよく使われるJSONとの親和性が非常に高い

### ユースケース
Webサイトのコンテンツ管理、ECサイトの商品カタログ、ユーザープロファイル管理など

### 代表的な製品
- MongoDB: ドキュメント型NoSQLの代表格。豊富な機能と高い人気を誇る
- Amazon DocumentDB: AWSが提供するMongoDB互換のマネージドサービス


## 2.3.2 キーバリュー型 (KVS)

### 概要
「キー」と「値（バリュー）」という非常にシンプルなペアのみでデータを管理します。キーを指定すると、対応する値が一意に取得できます。

### 特徴
- 構造がシンプルなため、読み書きの速度が極めて高速
- スケールアウトが容易
- 複雑な検索やデータの関連付けは苦手

### ユースケース
Webアプリケーションのセッション管理、頻繁にアクセスされるデータのキャッシュ、リアルタイムランキングなど

### 代表的な製品
- Redis: インメモリ（データをメモリ上に格納）で動作するため超高速。キャッシュ用途で広く利用される
- Amazon DynamoDB: AWSが提供するフルマネージドのキーバリュー型およびドキュメント型データベース

## 2.3.3 カラム指向型 (ワイドカラムストア)

### 概要
RDBが行単位でデータを格納するのに対し、カラム（列）単位でデータを格納します。これにより、特定の列に対する集計や分析が高速になります。

### 特徴
- 大量の書き込み処理に非常に強い（Write-intensive）
- 列の追加や削除が容易で、柔軟なスキーマを持つ
- 特定の行の全データを取得するような処理は、RDBに比べて非効率になる場合がある

### ユースケース
IoTデバイスからのセンサーデータ、アクセスログ、メッセージングアプリの履歴など、時系列データの記録・分析

### 代表的な製品
- Apache Cassandra: Facebookが開発。高いスケーラビリティと可用性を誇る
- Google Cloud Bigtable: Googleが提供するフルマネージドのワイドカラムストア

## 2.3.4 グラフ型

### 概要
データそのものを「ノード（点）」、データ間の関連性を「エッジ（線）」として表現し、格納します。データ同士の「つながり」を効率的に扱うことに特化しています。

### 特徴
- RDBでは複雑なJOINが必要になるような、深い階層の関連性をたどるクエリが非常に高速
- データモデルが直感的で理解しやすい

### ユースケース
SNSの友人関係、経路検索（ナビゲーション）、不正検知、レコメンデーションエンジンなど

### 代表的な製品
- Neo4j: グラフ型データベースのリーダー的存在。専用のクエリ言語「Cypher」を持つ
- Amazon Neptune: AWSが提供するフルマネージドのグラフデータベースサービス

# 【重要概念】CAP定理

## 概要
分散システム（複数のサーバーで構成されるシステム）において、以下の3つの性質を同時に満たすことはできないという定理
- Consistency (一貫性): どのサーバーにアクセスしても、常に最新の同じデータが返ってくる
- Availability (可用性): いつでも必ず、何らかの応答が返ってくる（システムが止まらない）
- Partition Tolerance (分断耐性): ネットワークの分断（一部のサーバーが通信不能）が起きても、システム全体は動き続ける。

## トレードオフの関係

### CP（一貫性 + 分断耐性）
- ネットワーク分断時に可用性を犠牲にする
- 例：MongoDB、HBase、Redis Cluster
- 分断発生時は一部ノードへの書き込みを停止し、データの一貫性を保つ

### AP（可用性 + 分断耐性）
- 一貫性を犠牲にして、常にサービスを提供
- 例：Cassandra、DynamoDB（Eventually Consistent設定）
- 分断時も書き込みを受け付け、後で整合性を取る（結果整合性）

### CA（一貫性 + 可用性）
- 分断耐性を犠牲にする（単一障害点を許容）
- 例：従来のRDBMS（単一インスタンス）
- ネットワーク分断が発生しない前提で設計

<img width="809" height="216" alt="スクリーンショット 2025-07-16 7 32 11" src="https://github.com/user-attachments/assets/c0353057-fd42-492d-9a36-84f0af86fdda" />

# クイズタイム！ 🧐
Q1. 顧客情報と注文履歴を厳密に管理する必要があるECサイトの基幹システム。最適なのはどっち？
- A. RDB
- B. NoSQL

Q2. 投稿、いいね、コメントなど、将来的に機能がどんどん追加される可能性のある新しいSNS。柔軟に対応しやすいのはどっち？
- A. RDB
- B. NoSQL

Q3. CAP定理において、銀行の残高照会のように「絶対に正しい、最新のデータ」を返すことを優先する場合、諦める可能性があるのは可用性(A)と一貫性(B)のどっち？
- A. 可用性 (Availability)
- B. 一貫性 (Consistency)

# 2.4. RDBとNoSQLの使い分け
「どちらが優れているか」ではなく、「何を実現したいか」で選ぶことが最も重要です
システムの要件を以下の3つの軸で考えてみましょう

## 軸1：データの一貫性（Consistency）
データの「正しさ」をどれだけ厳密に求めるか？
### RDB側（強い一貫性）
- 特徴: トランザクション処理（ACID特性）により、データの矛盾が絶対に許されない処理に向いています
- 例: 銀行の残高、ECサイトの在庫数、会計データなど
### NoSQL側（結果整合性）
- 特徴: 処理の瞬間に全データが一致していなくても、最終的に（Eventually）正しい状態になれば良い、という考え方。可用性を重視します
- 例: SNSの「いいね！」の数、アクセス数のカウンター（多少のズレは許容できる）

## 軸2：スキーマの柔軟性（Flexibility）
扱うデータの「形」は決まっているか？
### RDB側（厳密なスキーマ）:
- 特徴: 事前にテーブルの構造をカッチリと定義します。構造が明確で、変更が少ないデータに適しています。
- 例: 顧客台帳、従業員名簿、定型的な伝票データ。
### NoSQL側（柔軟なスキーマ）:
- 特徴: スキーマレス、または非常に柔軟なスキーマを持ちます。データ構造が未定だったり、後から項目が頻繁に追加・変更されたりするケースに強いです。
- 例: 商品ごとに項目が異なるECサイトの商品データ、ユーザーが自由に項目を追加できるプロフィール

## 軸3：システムの拡張性（Scalability）
将来のデータ量やアクセス増にどう備えるか？
### RDB側（スケールアップ）:
- 特徴: サーバー1台の性能（CPU, メモリ）を上げることで対応するのが基本。性能向上には限界があり、コストも高くなりがちです。
- 例: 性能要件がある程度予測できる中〜大規模システム
### NoSQL側（スケールアウト）:
- 特徴: サーバーの台数を増やすことで、システム全体の性能をリニアに向上させます。ビッグデータや急激なアクセス増に対応しやすいです。
- 例: 世界中で利用されるSNS、大量のログを収集するシステム

## まとめ表
<img width="663" height="217" alt="スクリーンショット 2025-07-16 2 01 14" src="https://github.com/user-attachments/assets/a17be4af-8231-4edc-ac6f-5e3c721efaad" />

# 2.5. 主要なRDBMS製品の特徴

## MySQL

### 概要
世界で最も普及しているオープンソースRDBMS。特にWebアプリケーションのバックエンドとして、LAMP環境（Linux, Apache, MySQL, PHP/Perl/Python）で絶大な人気を誇る

### 特徴
- シンプルな構成で、高速な読み書き性能を持つ
- 用途に応じてストレージエンジン（InnoDB, MyISAMなど）を選択可能
- レプリケーション（複製）機能が充実しており、可用性を高めやすい

### キーワード
- オープンソース
- Webの定番
- 高速

## PostgreSQL

### 概要
機能の豊富さと拡張性の高さから「最も先進的なオープンソースデータベース」とも呼ばれる。標準SQLへの準拠度が高い

### 特徴
- トランザクションや複雑なクエリの処理性能に定評がある
- JSONB型（バイナリJSON）やPostGIS（地理情報拡張）など、多彩なデータ型をサポート
- 手続き型言語（PL/pgSQLなど）により、データベース内で複雑なロジックを実装可能

### キーワード
- 高機能
- 拡張性
- 標準準拠

## Oracle Database

### 概要
Oracle社が開発する商用データベースの代表格。金融機関や大企業の基幹システムなど、極めて高い信頼性が求められる場面で採用される

### 特徴
- 堅牢なトランザクション処理と、高度なセキュリティ機能
- Real Application Clusters (RAC) による高可用性とスケーラビリティ
- 豊富な管理ツールと手厚いサポート体制が提供されるが、ライセンス費用は高額

### キーワード
- 商用
- 高信頼性
- エンタープライズ


# まとめ
RDBとNoSQLは対立するものではなく、適材適所
- RDB: データの一貫性が最優先されるシステム（決済、在庫管理など）に不可欠
- NoSQL: 柔軟性とスケーラビリティが求められるシステム（SNS、IoTデータなど）で真価を発揮

データベース選定は、システムの要件そのもの
- 実現したいサービスは何か？（ユースケース）
- 扱うデータの特性は？（スキーマ）
- どこまでの正確性と可用性が必要か？（CAP定理）

これらの概念を理解し、最適なデータベースを選択する判断力を養うことが重要
