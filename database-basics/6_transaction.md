# 6. トランザクションとACID特性

# 6.1. トランザクションとは何か
## 処理の「All or Nothing」を保証する論理的な作業単位
トランザクションとは、データベースに対する一連の操作（一つ以上のSQL文）をひとまとめにした、論理的な処理単位のことです 。
トランザクションの最も重要な特性は「原子性（Atomicity）」であり、これは「All or Nothing（すべて実行されるか、一切実行されないか）」の原則を保証することを意味します 。
つまり、トランザクションに含まれる全ての操作が成功した場合にのみ、その結果がデータベースに恒久的に保存されます。
もし一連の操作の途中で何らかのエラーや障害が発生した場合は、それまでに行われた全ての操作が取り消され、データベースはトランザクションが開始される前の状態に完全に戻されます。
この仕組みにより、中途半端な更新処理によってデータが矛盾した状態に陥ることを防ぎます。

## 具体例：銀行振込処理の舞台裏
トランザクションの概念を具体的に理解するために、銀行の口座振込処理を考えてみましょう。
Aさんの口座からBさんの口座へ1万円を送金する場合、システム内部では少なくとも以下の二つの操作が必要です。   

1.Aさんの口座残高から1万円を減らす（UPDATE文）

2.Bさんの口座残高に1万円を加算する（UPDATE文）

もし、1の処理が成功した直後にシステム障害が発生し、2の処理が実行されなかった場合、Aさんの口座から1万円が消えたにもかかわらず、Bさんの口座には入金されません。
これは、全体として1万円が消失したことを意味し、データの整合性が完全に崩壊した状態です。
しかし、これら二つの操作を一つのトランザクションとしてまとめることで、DBMSはその「All or Nothing」を保証します。
障害が発生すれば、Aさんの口座から1万円を減らす操作も自動的に取り消され、お金が消えるという事態を防ぐことができるのです。
このようにトランザクションは、現実世界のビジネスルールをデータベース上で安全に実現するための不可欠な仕組みです。

<img width="846" height="616" alt="スクリーンショット 2025-08-17 21 32 23" src="https://github.com/user-attachments/assets/598d0b2d-a811-4b80-baa2-01a567d1a46b" />

## COMMIT と ROLLBACK 変更の確定と破棄
トランザクションのライフサイクルは、二つの基本的なコマンドによって制御されます。

COMMIT: トランザクション内の全ての操作が正常に完了したことを宣言し、その変更をデータベースに恒久的に反映させる命令です。COMMITが実行されると、変更内容は確定し、他のトランザクションからも参照可能になります 。   

ROLLBACK: トランザクション内でエラーが発生した場合や、処理を意図的に中断したい場合に、それまでに行った全ての変更を破棄し、データベースをトランザクション開始前の状態に戻す命令です 。これが「Nothing」の部分を強制するメカニズムです。   

開発者は、一連のビジネスロジックの成功をもってCOMMITを実行し、途中で問題が検知された場合にはROLLBACKを実行することで、データの整合性を能動的に管理します。

## 2.1.2 特徴
<img width="828" height="552" alt="スクリーンショット 2025-07-16 2 09 39" src="https://github.com/user-attachments/assets/1f0a0af7-eb54-4050-ae55-cc6c30915af1" />

- データの整合性を保証 (ACID特性)
  - Atomicity (原子性): トランザクションは全て成功 or 全て失敗
  - Consistency (一貫性): データは常に正しい状態を保つ
  - Isolation (独立性): 複数の処理が互いに影響しない
  - Durability (永続性): 一度完了した処理は失われない
- 事前に厳密なスキーマ（データの構造）を定義する必要がある

