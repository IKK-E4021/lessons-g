# 8. Shared Signals Framework (SSF)と関連標準

## 8.1. はじめに：セキュリティイベント共有の重要性

今日の複雑なIT環境において、セキュリティイベントは単一のシステムやサービス内で完結することは稀です。ユーザーアカウントの侵害、デバイスの紛失、不正なアクセス試行など、あるサービスで検知されたセキュリティイベントは、他の連携サービスにも影響を及ぼす可能性があります。

従来、これらの情報は各サービス間で十分に共有されておらず、以下のような課題がありました。

- **対応の遅延**: あるサービスでアカウントが侵害されても、他のサービスがその情報を知るまでに時間がかかり、被害が拡大する可能性があります。
- **ユーザーエクスペリエンスの低下**: 各サービスが個別にリスク評価を行うため、ユーザーは何度も追加の認証を求められることがあります。
- **運用コストの増大**: 各サービスが独自にセキュリティ対策を講じる必要があり、全体としての運用コストが増加します。

Shared Signals Framework (SSF) は、これらの課題を解決するために、**セキュリティイベント情報を標準化された方法でリアルタイムに共有するためのフレームワーク**です。これにより、エコシステム全体で迅速かつ協調的なセキュリティ対応を実現し、ユーザーエクスペリエンスを向上させることを目指します。

## 8.2. Shared Signals Framework (SSF) の概要

SSFは、OpenID Foundation内のワーキンググループで標準化が進められています。主な目的は、サービスプロバイダー間でセキュリティ関連の「シグナル」を交換するための標準的な方法を定義することです。

SSF自体はプロトコルではなく、以下の2つの主要なプロトコル仕様に基づいています。

1. **CAEP (Continuous Access Evaluation Protocol)**: 継続的アクセス評価プロトコル
2. **RISC (Risk and Incident Sharing and Coordination)**: リスク・インシデント共有・連携プロトコル

これらのプロトコルは、特定のセキュリティイベントが発生した際に、関連するシステム間で情報を伝達するためのメッセージ形式や交換方法を定義しています。

### 8.2.1. CAEP (Continuous Access Evaluation Protocol)

CAEP（「ケイプ」と発音されることもあります）は、**セッションやアクセストークンの状態変化に関する情報をリアルタイムに伝達する**ためのプロトコルです。

例えば、以下のようなイベントを通知できます。

- セッション失効 (例: ユーザーログアウト、管理者による強制終了)
- トークン失効
- 認証保証レベルの変更 (例: 多要素認証の無効化)
- デバイスコンプライアンスの変更 (例: デバイスがマルウェア感染)

### 8.2.2. RISC (Risk and Incident Sharing and Coordination)

RISCは、**アカウント侵害や不正行為などのセキュリティインシデントに関する情報を共有し、協調的な対応を可能にする**ためのプロトコルです。

例えば、以下のようなイベントを通知できます。

- アカウント認証情報の侵害 (例: パスワード漏洩検知)
- アカウント無効化
- アカウント回復
- 識別子の変更 (例: メールアドレス変更)

## 8.3. 具体的なユースケース：エンドユーザー向けサービスでのSSF活用

SSFが実際にどのように役立つのか、エンドユーザー向けのオンラインサービスを例に見てみましょう。

**シナリオ：オンラインショッピングサイトと決済サービス連携**

あるユーザーが、普段利用しているオンラインショッピングサイトAで買い物をし、連携している決済サービスBで支払いをしようとしています。

1. **不審なログイン試行の検知 (RISC)**:
    - ユーザーがショッピングサイトAにログインしようとした際、普段とは異なる国からのアクセスや、短時間に多数のログイン失敗が観測されました。
    - ショッピングサイトAの不正検知システムは、これをアカウント乗っ取りの試みである可能性が高いと判断します。
    - ショッピングサイトAは、RISCの「アカウント認証情報の侵害の疑い」イベントを、連携する決済サービスBや、ユーザーが利用している可能性のある他の連携サービス（例：ポイントサービスC）に送信します。
2. **決済サービスでの対応 (RISC & CAEP)**:
    - 決済サービスBは、ショッピングサイトAからRISCイベントを受信します。
    - ユーザーが決済サービスBに既にログインしていた場合、決済サービスBはCAEPの「セッション失効」イベントを発行し、ユーザーのセッションを即座に無効化します。これにより、万が一攻撃者がショッピングサイトA経由で決済サービスBの利用を試みても、セッションが無効になっているため不正利用を防ぎます。
    - 同時に、決済サービスBはユーザーに対して、セキュリティリスクの通知とともに、パスワード変更や追加の本人確認（例：SMS認証、セキュリティ質問）を要求します。
3. **他の連携サービスでの対応 (RISC)**:
    - ポイントサービスCも同様にRISCイベントを受信し、該当ユーザーアカウントに対して一時的な利用制限をかけたり、高リスク取引をブロックしたりする措置を講じることができます。
4. **ユーザーによるアカウント回復と通知 (RISC)**:
    - ユーザーが決済サービスBでパスワード変更と追加認証を完了し、アカウントの安全性が確認されたとします。
    - 決済サービスBは、RISCの「アカウント回復」イベントをショッピングサイトAやポイントサービスCに送信します。
    - これを受けた各サービスは、必要に応じてアカウントの制限を解除したり、ユーザーに安全が確認されたことを通知したりします。

**図解：イベント伝播のイメージ**

+----------------------+ RISC Event +----------------------+ | ショッピングサイトA |------------------->| 決済サービスB | | (不正ログイン検知) | (侵害疑い通知) | (セッション失効、 | +----------------------+ | 追加認証要求) | | +----------------------+ | RISC Event (侵害疑い通知) | | | RISC Event V | (アカウント回復通知) +----------------------+ | | ポイントサービスC |<--------------------------------+ | (アカウント一時制限) | +----------------------+ _(ここに、より詳細なシーケンス図やコンポーネント図を挿入することを推奨します)_

このシナリオでは、SSFを活用することで、あるサービスで検知されたセキュリティリスクが、連携する他のサービスに迅速に伝播し、エコシステム全体で協調的な対応が可能になることを示しています。これにより、ユーザーアカウントの保護が強化され、不正利用のリスクが低減されます。

## 8.4. セキュリティイベントの種類と構造 (SECEVENT)

CAEPとRISCで共有されるセキュリティイベントは、**SECEVENT (Security Event Token)** と呼ばれるJWT (JSON Web Token) 形式のトークンで表現されます。

SECEVENTには、以下のような情報が含まれます。

- **iss (Issuer)**: イベントの発行者。
- **jti (JWT ID)**: イベントの一意な識別子。
- **iat (Issued At)**: イベントの発行時刻。
- **aud (Audience)**: イベントの受信者。
- **sub (Subject)**: イベントの対象（例: ユーザーID、セッションID）。
- **events**: 実際のイベント情報を含むJSONオブジェクト。この中にイベントタイプや詳細情報が記述されます。
    - 例 (CAEP): `urn:ietf:params:secevent:caep:session-revoked` (セッション失効イベント)

    - ペイロード例:

        ```json
        {
          "subject_type": "iss_sub",
          "subject": {
            "iss": "[<https://idp.example.com>](<https://idp.example.com>)",
            "sub": "user123"
          },
          "reason_admin": "User account compromised."
        }
        
        ```

    - 例 (RISC): `urn:ietf:params:secevent:risc:account-credential-change-required` (認証情報変更要求イベント)

    - ペイロード例:

        ```json
        {
          "subject": {
            "subject_type": "email",
            "email": "user@example.com"
          },
          "reason": "Suspicious activity detected."
        }
        
        ```


SECEVENTの具体的なイベントタイプや属性は、各プロトコル (CAEP, RISC) やユースケースに応じて定義されています。これにより、異なるベンダーのシステム間でも相互運用可能な形でセキュリティ情報を交換できます。

## 8.5. リアルタイムセキュリティ対応への応用

SSF、CAEP、RISCを活用することで、以下のようなリアルタイムセキュリティ対応が実現可能になります。

- **侵害アカウントの即時無効化**: あるサービスでアカウント侵害が検知された場合、連携する全てのサービスで該当アカウントのセッションを即座に無効化し、被害の拡大を最小限に抑える。
- **動的なアクセス制御**: ユーザーのデバイスがセキュリティポリシーを満たさなくなった場合（例: MDMからの通知）、機密情報へのアクセスを制限したり、追加の認証を要求したりする。
- **ユーザーへの迅速な通知と対応促進**: アカウントに関する不審なアクティビティが検知された場合、ユーザーに即座に通知し、パスワード変更や二要素認証の設定を促す。
- **フィッシング攻撃への対策**: フィッシングサイトへのログイン試行が検知された場合、その情報を共有し、他のサービスでの同様の攻撃を防ぐ。
- **ユーザーエクスペリエンスの向上**: リスクレベルに応じて認証要求を調整することで、不要な認証ステップを削減し、利便性を損なわずにセキュリティを確保する。例えば、信頼できるデバイスからのアクセスや、低リスクな操作に対しては、追加認証を省略する。

## 8.6. 他のセキュリティ技術との連携・比較

SSFは、既存のセキュリティ技術やコンセプトと連携することで、その効果をさらに高めることができます。

### 8.6.1. ゼロトラストアーキテクチャにおける位置づけ

ゼロトラストは「決して信頼せず、常に検証する (Never Trust, Always Verify)」という原則に基づいたセキュリティモデルです。SSFは、この「継続的な検証」を実現するための重要な要素となります。

- ユーザーの行動、デバイスの状態、ロケーションなどの変化をリアルタイムに評価し、アクセスポリシーを動的に適用するために、SSF経由で共有されるシグナルが活用されます。
- 例えば、ユーザーが信頼できないネットワークに接続した場合、その情報がCAEPを通じてRPに通知され、RPはセッションのリスクレベルを再評価し、必要に応じてアクセス権限を制限したり、追加認証を要求したりします。

### 8.6.2. SIEM/SOARとの連携

- **SIEM (Security Information and Event Management)**: 様々なソースからログを収集・分析し、脅威を検知します。SIEMが検知した重要なセキュリティイベント（例：マルウェア感染、内部不正の兆候）をSSFを通じて関連サービスに通知することで、より迅速な対応が可能になります。
- **SOAR (Security Orchestration, Automation and Response)**: セキュリティ運用を自動化・効率化するプラットフォームです。SSFからのシグナルをトリガーとして、SOARプラットフォームが事前に定義されたプレイブック（対応手順）を自動実行する（例：侵害アカウントの自動ロック、関連部署への通知）といった連携が考えられます。

### 8.6.3. 従来のセッション管理との違い

従来のセッション管理では、アクセストークンの有効期限を短く設定したり、RPが定期的にIdPにトークンの有効性を問い合わせる（ポーリング）といった方法が取られてきました。

- **ポーリングの限界**: ポーリング間隔が長いと、トークンが失効してから実際にアクセスが拒否されるまでにタイムラグが生じます。間隔を短くすると、IdPへの負荷が増大します。
- **SSF (プッシュ型通知) の利点**: SSFはイベント発生時にIdPからRPへ即座に通知（プッシュ）するため、ほぼリアルタイムでの対応が可能です。これにより、セキュリティの向上とシステム負荷の軽減を両立できます。

## 8.7. SSF導入のメリットと課題

### 8.7.1. メリット

- **インシデント対応の迅速化**: セキュリティイベントのリアルタイム共有により、侵害の影響範囲特定や封じ込めまでの時間を大幅に短縮できます。
- **ユーザーエクスペリエンスの向上**: リスクベースの動的なアクセス制御により、ユーザーは不必要な認証ステップから解放され、利便性が向上します。
- **セキュリティ運用コストの削減**: イベント共有と対応の自動化により、手動での調査や対応にかかる工数を削減できます。
- **エコシステム全体のセキュリティ強化**: 参加するサービスプロバイダーが増えるほど、共有される情報の価値が高まり、エコシステム全体のセキュリティレベルが向上します。
- **標準化による相互運用性**: 標準化されたプロトコルを利用するため、異なるベンダーの製品やサービス間でも連携が容易になります。

### 8.7.2. 課題・考慮点

- **標準への対応状況と普及**: SSFに対応したIdP、RP、セキュリティ製品はまだ発展途上であり、エコシステム全体での普及には時間がかかる可能性があります。
- **設定・運用の複雑さ**: 共有するイベントの種類、連携先、通知ポリシーなどを適切に設定・管理するには、専門的な知識や体制が必要となる場合があります。
- **プライバシーへの配慮**: 共有されるイベント情報には機微な情報が含まれる可能性があるため、適切な同意管理、データの最小化、匿名化などのプライバシー保護措置が不可欠です。
- **エコシステム全体の協力と信頼**: SSFの効果を最大限に発揮するには、多くのサービスプロバイダーが積極的に参加し、信頼できる情報を共有する文化を醸成する必要があります。誤った情報や悪意のある情報が共有されるリスクも考慮しなければなりません。
- **イベントの解釈と対応の一貫性**: 受信したイベントをどのように解釈し、どのような対応を取るかについては、各サービスプロバイダー間である程度の一貫性が求められます。

## 8.8. 今後の展望と期待

SSFはまだ新しい技術ですが、その将来性は非常に大きいと考えられます。

- **対応製品・サービスの拡大**: 主要なIdPベンダーや大手サービスプロバイダーが対応を進めており、今後さらに多くの製品・サービスでの採用が期待されます。
- **より多様なシグナルの活用**: 現在定義されているイベントタイプに加え、IoTデバイスのセキュリティ状態、ユーザーの生体認証情報に関するシグナルなど、より多様な情報が共有されるようになる可能性があります。
- **AI/機械学習との連携強化**: AIや機械学習を用いて、大量のセキュリティシグナルからより高度な脅威インテリジェンスを抽出し、予測的なセキュリティ対策や自動化されたインシデントレスポンスの精度向上が期待されます。
- **業界標準としての定着**: 金融業界におけるFAPIのように、特定の業界やユースケースにおいてSSFの利用が標準となる可能性があります。
- **クロスドメインでの連携**: 企業内システムだけでなく、異なる組織間や業界間でのセキュリティ情報共有が進むことで、より広範なサイバー攻撃への耐性が向上することが期待されます。

## 8.9. まとめ

Shared Signals Framework (SSF) は、CAEPやRISCといったプロトコルを通じて、セキュリティイベント情報を標準化された方法で共有するための重要な取り組みです。これにより、企業や組織は、サイバー攻撃に対してより迅速かつ効果的に対応し、エコシステム全体のセキュリティレベルを向上させることができます。

導入にはいくつかの課題も伴いますが、それを乗り越えることで得られるメリットは大きく、今後のデジタル社会におけるセキュリティ基盤の一つとして発展していくことが期待されます。

---

## 8.10. 質疑応答（想定される質問と回答例）

**Q1: 具体的にどの製品やサービスがSSFに対応していますか？** A1: OpenID Foundationのウェブサイトや、各IdPベンダー（例: Okta, Ping Identity, Microsoft Azure ADなど）のドキュメントで最新の対応状況を確認できます。まだ新しいフレームワークであるため、対応製品は順次拡大している状況です。

**Q2: 中小企業でもSSFを導入するメリットはありますか？ また、導入のハードルは？** A2: メリットはあります。特にクラウドサービスを多用している場合、サービス間の連携セキュリティを強化できます。導入のハードルとしては、対応するIdPやサービスを利用しているか、専門知識を持つ人材がいるかなどが挙げられます。まずは利用しているSaaSプロバイダーがSSFに対応しているか確認することから始めると良いでしょう。

**Q3: SSFを導入しない場合、どのようなリスクが考えられますか？** A3: アカウント侵害が発生した際に、その情報が他の連携サービスに迅速に伝わらず、被害が拡大するリスクがあります。また、ユーザーは各サービスで個別にリスク評価されるため、過剰な認証を求められるなどUXが悪化する可能性も考えられます。

**Q4: SSFで共有される情報によって、プライバシーが侵害される懸念はありませんか？** A4: その懸念はあります。そのため、SSFの仕様では、共有する情報を必要最小限にすること、イベントの購読・配信に関してユーザーの同意を得ることなどが考慮されています。運用にあたっては、プライバシーポリシーを明確にし、適切なデータ管理を行うことが重要です。

**Q5: SSFと既存のAPIセキュリティ（例：APIキー、OAuthスコープ）との違いは何ですか？** A5: APIキーやOAuthスコープは、主に「誰が何にアクセスできるか」という静的な認可を制御します。一方SSFは、認可された後のセッションやアカウントの状態変化といった「動的なセキュリティイベント」をリアルタイムに共有し、継続的なアクセス評価を可能にする点で異なります。これらは補完関係にあり、組み合わせて利用することでより強固なセキュリティを実現できます。