<svg viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <linearGradient id="dangerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#fef2f2;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#fee2e2;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="warningGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#fffbeb;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#fef3c7;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="successGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#f0fdf4;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#dcfce7;stop-opacity:1" />
        </linearGradient>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
            </feMerge>
        </filter>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.3"/>
        </filter>
        <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
        </marker>
        <marker id="greenArrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
        </marker>
    </defs>

    <!-- 背景 -->
    <rect width="1400" height="900" fill="#f8fafc"/>

    <!-- タイトル -->
    <rect x="0" y="0" width="1400" height="70" fill="#1e40af"/>
    <text x="700" y="40" text-anchor="middle" fill="white" font-size="24" font-weight="bold">
        RISC イベント伝播フロー：不正ログイン検知から連携サービスでの自動対応まで
    </text>

    <!-- 時系列ライン -->
    <line x1="100" y1="120" x2="1300" y2="120" stroke="#cbd5e1" stroke-width="2"/>
    <text x="100" y="110" fill="#64748b" font-size="12" font-weight="bold">時刻: T</text>
    <text x="400" y="110" fill="#64748b" font-size="12" font-weight="bold">T+1秒</text>
    <text x="700" y="110" fill="#64748b" font-size="12" font-weight="bold">T+2秒</text>
    <text x="1000" y="110" fill="#64748b" font-size="12" font-weight="bold">T+3秒</text>
    <text x="1300" y="110" fill="#64748b" font-size="12" font-weight="bold">T+4秒</text>

    <!-- Phase 1: 不正ログイン検知 -->
    <g transform="translate(50, 150)">
        <rect x="0" y="0" width="300" height="180" rx="10" fill="url(#dangerGradient)" stroke="#ef4444" stroke-width="2" filter="url(#shadow)"/>
        <text x="150" y="25" text-anchor="middle" fill="#dc2626" font-size="16" font-weight="bold">Phase 1: 脅威検知</text>

        <!-- 攻撃者アイコン -->
        <circle cx="80" cy="60" r="25" fill="#fca5a5" stroke="#ef4444" stroke-width="2"/>
        <text x="80" y="67" text-anchor="middle" fill="#991b1b" font-size="14" font-weight="bold">🔓</text>
        <text x="80" y="95" text-anchor="middle" fill="#991b1b" font-size="12" font-weight="bold">攻撃者</text>

        <!-- Google IdP -->
        <rect x="180" y="40" width="100" height="60" rx="8" fill="white" stroke="#ef4444" stroke-width="2"/>
        <text x="230" y="60" text-anchor="middle" fill="#ef4444" font-size="12" font-weight="bold">Google IdP</text>
        <text x="230" y="75" text-anchor="middle" fill="#ef4444" font-size="10">不正ログイン</text>
        <text x="230" y="87" text-anchor="middle" fill="#ef4444" font-size="10">検知！</text>

        <!-- 矢印 -->
        <path d="M 105 70 L 175 70" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
        <text x="140" y="65" text-anchor="middle" fill="#ef4444" font-size="10">不正アクセス</text>

        <!-- 検知内容 -->
        <text x="20" y="125" fill="#991b1b" font-size="12" font-weight="bold">検知内容:</text>
        <text x="20" y="140" fill="#991b1b" font-size="11">• 異常な地理的位置</text>
        <text x="20" y="152" fill="#991b1b" font-size="11">• 未知のデバイス</text>
        <text x="20" y="164" fill="#991b1b" font-size="11">• 複数回のログイン失敗後</text>
    </g>

    <!-- Phase 2: RISC Event生成 -->
    <g transform="translate(370, 150)">
        <rect x="0" y="0" width="300" height="180" rx="10" fill="url(#warningGradient)" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="150" y="25" text-anchor="middle" fill="#d97706" font-size="16" font-weight="bold">Phase 2: SET生成・送信</text>

        <!-- SSE Framework -->
        <rect x="30" y="40" width="240" height="100" rx="8" fill="white" stroke="#f59e0b" stroke-width="2"/>
        <text x="150" y="60" text-anchor="middle" fill="#d97706" font-size="14" font-weight="bold">SSE Framework</text>

        <!-- SET詳細 -->
        <rect x="40" y="70" width="220" height="60" rx="5" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
        <text x="150" y="85" text-anchor="middle" fill="#92400e" font-size="11" font-weight="bold">Security Event Token (SET)</text>
        <text x="50" y="100" fill="#92400e" font-size="9">event_type: account-credential-change-required</text>
        <text x="50" y="112" fill="#92400e" font-size="9">subject: user@example.com</text>
        <text x="50" y="124" fill="#92400e" font-size="9">issuer: accounts.google.com</text>

        <!-- 送信内容 -->
        <text x="20" y="160" fill="#d97706" font-size="12" font-weight="bold">送信内容:</text>
        <text x="20" y="175" fill="#d97706" font-size="11">JWT形式で暗号化・署名済み</text>
    </g>

    <!-- 伝播矢印 -->
    <g>
        <!-- Phase 1 → Phase 2 -->
        <path d="M 350 240 L 370 240" stroke="#f59e0b" stroke-width="4" fill="none" marker-end="url(#arrow)"/>

        <!-- Phase 2 → Receivers -->
        <path d="M 670 200 Q 720 180 750 200" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#greenArrow)"/>
        <path d="M 670 240 L 750 240" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#greenArrow)"/>
        <path d="M 670 280 Q 720 300 750 280" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#greenArrow)"/>

        <text x="710" y="175" text-anchor="middle" fill="#22c55e" font-size="10" font-weight="bold">並行配信</text>
    </g>

    <!-- Phase 3: 各サービスでの対応 -->
    <g transform="translate(750, 150)">
        <!-- Slack -->
        <rect x="0" y="0" width="200" height="60" rx="8" fill="url(#successGradient)" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
        <text x="100" y="20" text-anchor="middle" fill="#16a34a" font-size="12" font-weight="bold">Slack (SSO連携)</text>
        <text x="100" y="35" text-anchor="middle" fill="#16a34a" font-size="11">→ セッション強制終了</text>
        <text x="100" y="50" text-anchor="middle" fill="#16a34a" font-size="11">→ 再認証要求</text>

        <!-- Salesforce -->
        <rect x="0" y="80" width="200" height="60" rx="8" fill="url(#successGradient)" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
        <text x="100" y="100" text-anchor="middle" fill="#16a34a" font-size="12" font-weight="bold">Salesforce</text>
        <text x="100" y="115" text-anchor="middle" fill="#16a34a" font-size="11">→ アクセス権限一時停止</text>
        <text x="100" y="130" text-anchor="middle" fill="#16a34a" font-size="11">→ 管理者に通知</text>

        <!-- Microsoft 365 -->
        <rect x="0" y="160" width="200" height="60" rx="8" fill="url(#successGradient)" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
        <text x="100" y="180" text-anchor="middle" fill="#16a34a" font-size="12" font-weight="bold">Microsoft 365</text>
        <text x="100" y="195" text-anchor="middle" fill="#16a34a" font-size="11">→ 条件付きアクセス適用</text>
        <text x="100" y="210" text-anchor="middle" fill="#16a34a" font-size="11">→ MFA強制</text>
    </g>

    <!-- Phase 4: セキュリティ向上 -->
    <g transform="translate(1050, 150)">
        <rect x="0" y="0" width="300" height="180" rx="10" fill="#e0f2fe" stroke="#0284c7" stroke-width="2" filter="url(#shadow)"/>
        <text x="150" y="25" text-anchor="middle" fill="#0369a1" font-size="16" font-weight="bold">Phase 4: エコシステム保護</text>

        <!-- 保護状態アイコン -->
        <circle cx="150" cy="70" r="30" fill="#bae6fd" stroke="#0284c7" stroke-width="2"/>
        <text x="150" y="78" text-anchor="middle" fill="#0369a1" font-size="20" font-weight="bold">🛡️</text>

        <text x="150" y="110" text-anchor="middle" fill="#0369a1" font-size="14" font-weight="bold">攻撃の横展開を阻止</text>

        <!-- 効果 -->
        <text x="20" y="135" fill="#0369a1" font-size="12" font-weight="bold">達成された効果:</text>
        <text x="20" y="150" fill="#0369a1" font-size="11">✓ 全連携サービスで自動対応</text>
        <text x="20" y="162" fill="#0369a1" font-size="11">✓ 攻撃の拡散防止</text>
        <text x="20" y="174" fill="#0369a1" font-size="11">✓ ユーザーデータ保護</text>
    </g>

    <!-- 下部の詳細フロー -->
    <g transform="translate(100, 400)">
        <rect x="0" y="0" width="1200" height="250" rx="15" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
        <text x="600" y="30" text-anchor="middle" fill="#1e293b" font-size="18" font-weight="bold">
            詳細なイベント伝播メカニズム
        </text>

        <!-- ステップ詳細 -->
        <g transform="translate(50, 50)">
            <!-- Step 1 -->
            <rect x="0" y="0" width="250" height="150" rx="8" fill="#fef7ff" stroke="#a855f7" stroke-width="1"/>
            <circle cx="125" cy="20" r="12" fill="#a855f7"/>
            <text x="125" y="26" text-anchor="middle" fill="white" font-size="10" font-weight="bold">1</text>
            <text x="125" y="45" text-anchor="middle" fill="#7c3aed" font-size="12" font-weight="bold">イベント検知</text>
            <text x="15" y="65" fill="#374151" font-size="10">• リスク分析エンジンが異常検知</text>
            <text x="15" y="80" fill="#374151" font-size="10">• 信頼スコアの急激な低下</text>
            <text x="15" y="95" fill="#374151" font-size="10">• 既知脅威パターンとの照合</text>
            <text x="15" y="110" fill="#374151" font-size="10">• コンテキスト分析による確認</text>
            <text x="15" y="125" fill="#374151" font-size="10">• イベント重要度の決定</text>
        </g>

        <g transform="translate(300, 50)">
            <!-- Step 2 -->
            <rect x="0" y="0" width="250" height="150" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="1"/>
            <circle cx="125" cy="20" r="12" fill="#3b82f6"/>
            <text x="125" y="26" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2</text>
            <text x="125" y="45" text-anchor="middle" fill="#2563eb" font-size="12" font-weight="bold">SET生成</text>
            <text x="15" y="65" fill="#374151" font-size="10">• JWTペイロード構築</text>
            <text x="15" y="80" fill="#374151" font-size="10">• イベントタイプ指定</text>
            <text x="15" y="95" fill="#374151" font-size="10">• 対象ユーザー識別子設定</text>
            <text x="15" y="110" fill="#374151" font-size="10">• タイムスタンプ付与</text>
            <text x="15" y="125" fill="#374151" font-size="10">• デジタル署名・暗号化</text>
        </g>

        <g transform="translate(600, 50)">
            <!-- Step 3 -->
            <rect x="0" y="0" width="250" height="150" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="1"/>
            <circle cx="125" cy="20" r="12" fill="#22c55e"/>
            <text x="125" y="26" text-anchor="middle" fill="white" font-size="10" font-weight="bold">3</text>
            <text x="125" y="45" text-anchor="middle" fill="#16a34a" font-size="12" font-weight="bold">イベント配信</text>
            <text x="15" y="65" fill="#374151" font-size="10">• 登録済みReceiver特定</text>
            <text x="15" y="80" fill="#374151" font-size="10">• Push/Poll配信選択</text>
            <text x="15" y="95" fill="#374151" font-size="10">• 並行配信実行</text>
            <text x="15" y="110" fill="#374151" font-size="10">• 配信確認・再送制御</text>
            <text x="15" y="125" fill="#374151" font-size="10">• 配信ログ記録</text>
        </g>

        <g transform="translate(900, 50)">
            <!-- Step 4 -->
            <rect x="0" y="0" width="250" height="150" rx="8" fill="#fef2f2" stroke="#ef4444" stroke-width="1"/>
            <circle cx="125" cy="20" r="12" fill="#ef4444"/>
            <text x="125" y="26" text-anchor="middle" fill="white" font-size="10" font-weight="bold">4</text>
            <text x="125" y="45" text-anchor="middle" fill="#dc2626" font-size="12" font-weight="bold">自動対応</text>
            <text x="15" y="65" fill="#374151" font-size="10">• SET検証・復号化</text>
            <text x="15" y="80" fill="#374151" font-size="10">• ローカルポリシー適用</text>
            <text x="15" y="95" fill="#374151" font-size="10">• リスクレベル評価</text>
            <text x="15" y="110" fill="#374151" font-size="10">• セキュリティアクション実行</text>
            <text x="15" y="125" fill="#374151" font-size="10">• ユーザー・管理者通知</text>
        </g>

        <!-- 矢印 -->
        <path d="M 250 125 L 300 125" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#greenArrow)"/>
        <path d="M 550 125 L 600 125" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#greenArrow)"/>
        <path d="M 850 125 L 900 125" stroke="#6366f1" stroke-width="2" fill="none" marker-end="url(#greenArrow)"/>
    </g>

    <!-- パフォーマンス指標 -->
    <g transform="translate(100, 700)">
        <rect x="0" y="0" width="1200" height="120" rx="10" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
        <text x="600" y="25" text-anchor="middle" fill="#1e293b" font-size="16" font-weight="bold">
            RISCの効果とパフォーマンス指標
        </text>

        <!-- 指標カード -->
        <g transform="translate(100, 40)">
            <rect x="0" y="0" width="180" height="60" rx="5" fill="white" stroke="#22c55e" stroke-width="1"/>
            <text x="90" y="20" text-anchor="middle" fill="#16a34a" font-size="14" font-weight="bold">応答時間</text>
            <text x="90" y="35" text-anchor="middle" fill="#16a34a" font-size="20" font-weight="bold">< 2秒</text>
            <text x="90" y="50" text-anchor="middle" fill="#16a34a" font-size="10">イベント伝播完了</text>
        </g>

        <g transform="translate(320, 40)">
            <rect x="0" y="0" width="180" height="60" rx="5" fill="white" stroke="#3b82f6" stroke-width="1"/>
            <text x="90" y="20" text-anchor="middle" fill="#2563eb" font-size="14" font-weight="bold">スケーラビリティ</text>
            <text x="90" y="35" text-anchor="middle" fill="#2563eb" font-size="20" font-weight="bold">1000+</text>
            <text x="90" y="50" text-anchor="middle" fill="#2563eb" font-size="10">同時Receiver対応</text>
        </g>

        <g transform="translate(540, 40)">
            <rect x="0" y="0" width="180" height="60" rx="5" fill="white" stroke="#f59e0b" stroke-width="1"/>
            <text x="90" y="20" text-anchor="middle" fill="#d97706" font-size="14" font-weight="bold">信頼性</text>
            <text x="90" y="35" text-anchor="middle" fill="#d97706" font-size="20" font-weight="bold">99.9%</text>
            <text x="90" y="50" text-anchor="middle" fill="#d97706" font-size="10">配信成功率</text>
        </g>

        <g transform="translate(760, 40)">
            <rect x="0" y="0" width="180" height="60" rx="5" fill="white" stroke="#a855f7" stroke-width="1"/>
            <text x="90" y="20" text-anchor="middle" fill="#7c3aed" font-size="14" font-weight="bold">セキュリティ</text>
            <text x="90" y="35" text-anchor="middle" fill="#7c3aed" font-size="20" font-weight="bold">AES-256</text>
            <text x="90" y="50" text-anchor="middle" fill="#7c3aed" font-size="10">エンドツーエンド暗号化</text>
        </g>

        <g transform="translate(980, 40)">
            <rect x="0" y="0" width="180" height="60" rx="5" fill="white" stroke="#ef4444" stroke-width="1"/>
            <text x="90" y="20" text-anchor="middle" fill="#dc2626" font-size="14" font-weight="bold">攻撃阻止率</text>
            <text x="90" y="35" text-anchor="middle" fill="#dc2626" font-size="20" font-weight="bold">95%+</text>
            <text x="90" y="50" text-anchor="middle" fill="#dc2626" font-size="10">横展開攻撃防止</text>
        </g>
    </g>

    <!-- フッター -->
    <text x="700" y="860" text-anchor="middle" fill="#64748b" font-size="12">
        RISC：1つのセキュリティイベントが瞬時に複数サービスに伝播し、エコシステム全体を自動的に保護
    </text>
</svg>