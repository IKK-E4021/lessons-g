<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="800" height="600" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="400" y="40" text-anchor="middle" font-size="24" font-weight="bold" fill="#2c3e50">認可の記録フロー</text>
  
  <!-- User Icon -->
  <g transform="translate(380, 80)">
    <circle cx="20" cy="20" r="20" fill="#3498db"/>
    <path d="M20 22 C14 22 10 26 10 32 L30 32 C30 26 26 22 20 22 Z" fill="white"/>
    <circle cx="20" cy="15" r="8" fill="white"/>
  </g>
  <text x="400" y="140" text-anchor="middle" font-size="14" fill="#555">ユーザー認可リクエスト</text>
  
  <!-- Arrow 1 -->
  <path d="M400 150 L400 180" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
  
  <!-- Context Collection Box -->
  <g transform="translate(250, 190)">
    <rect width="300" height="80" rx="10" fill="#e8f4f8" stroke="#3498db" stroke-width="2"/>
    <text x="150" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#2c3e50">コンテキスト収集</text>
    <text x="20" y="55" font-size="12" fill="#555">• デバイス情報</text>
    <text x="120" y="55" font-size="12" fill="#555">• 位置情報</text>
    <text x="210" y="55" font-size="12" fill="#555">• 時刻</text>
  </g>
  
  <!-- Arrow 2 -->
  <path d="M400 270 L400 300" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
  
  <!-- Risk Assessment Box -->
  <g transform="translate(250, 310)">
    <rect width="300" height="80" rx="10" fill="#fef5e7" stroke="#f39c12" stroke-width="2"/>
    <text x="150" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#2c3e50">リスク評価</text>
    <circle cx="50" cy="55" r="15" fill="#27ae60"/>
    <text x="50" y="60" text-anchor="middle" font-size="12" fill="white">低</text>
    <circle cx="150" cy="55" r="15" fill="#f39c12"/>
    <text x="150" y="60" text-anchor="middle" font-size="12" fill="white">中</text>
    <circle cx="250" cy="55" r="15" fill="#e74c3c"/>
    <text x="250" y="60" text-anchor="middle" font-size="12" fill="white">高</text>
  </g>
  
  <!-- Side Arrow for Additional Auth -->
  <path d="M550 350 L620 350" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowred)"/>
  <text x="635" y="355" font-size="12" fill="#e74c3c">追加認証要求</text>
  
  <!-- Arrow 3 -->
  <path d="M400 390 L400 420" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
  
  <!-- Detailed Record Box -->
  <g transform="translate(250, 430)">
    <rect width="300" height="80" rx="10" fill="#e8f5e9" stroke="#27ae60" stroke-width="2"/>
    <text x="150" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#2c3e50">詳細記録の作成</text>
    <text x="20" y="55" font-size="12" fill="#555">• 認可ID生成</text>
    <text x="150" y="55" font-size="12" fill="#555">• フィンガープリント</text>
    <text x="260" y="55" font-size="12" fill="#555">• 制約条件</text>
  </g>
  
  <!-- Arrow 4 -->
  <path d="M400 510 L400 540" stroke="#3498db" stroke-width="3" marker-end="url(#arrowblue)"/>
  
  <!-- User Notification Box -->
  <g transform="translate(250, 550)">
    <rect width="300" height="40" rx="10" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
    <text x="150" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#2c3e50">ユーザー通知</text>
  </g>
  
  <!-- Notification Icons -->
  <g transform="translate(580, 555)">
    <!-- Email Icon -->
    <rect x="0" y="5" width="30" height="20" rx="2" fill="#9c27b0"/>
    <path d="M0 5 L15 15 L30 5" stroke="white" stroke-width="2" fill="none"/>
    
    <!-- Phone Icon -->
    <rect x="40" y="0" width="20" height="30" rx="3" fill="#9c27b0"/>
    <rect x="45" y="5" width="10" height="15" fill="white"/>
    <circle cx="50" cy="25" r="2" fill="white"/>
  </g>
  
  <!-- Arrow Definitions -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto" fill="#3498db">
      <path d="M 0 0 L 10 5 L 0 10 z"/>
    </marker>
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto" fill="#e74c3c">
      <path d="M 0 0 L 10 5 L 0 10 z"/>
    </marker>
  </defs>
</svg>