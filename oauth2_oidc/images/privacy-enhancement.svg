<svg viewBox="0 0 1000 700" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <!-- グラデーション定義 -->
        <linearGradient id="idpGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#357ABD;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="userGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#7ED321;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#5BA617;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="rpGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#F5A623;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#E89611;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="privacyGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#B8E986;stop-opacity:0.8" />
            <stop offset="100%" style="stop-color:#50E3C2;stop-opacity:0.8" />
        </linearGradient>
    </defs>

    <!-- 背景 -->
    <rect width="1000" height="700" fill="#F8F9FA"/>

    <!-- タイトル -->
    <text x="500" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2C3E50">OAuth/OIDC プライバシー強化技術</text>

    <!-- IdP (Identity Provider) -->
    <g id="idp">
        <rect x="50" y="200" width="150" height="120" rx="10" fill="url(#idpGradient)" stroke="#2980B9" stroke-width="2"/>
        <text x="125" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">IdP</text>
        <text x="125" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">認証プロバイダー</text>

        <!-- 鍵のアイコン -->
        <g transform="translate(115, 270)">
            <circle cx="0" cy="0" r="8" fill="white"/>
            <rect x="-3" y="0" width="6" height="12" fill="white"/>
            <rect x="-1" y="8" width="2" height="2" fill="#2980B9"/>
            <rect x="1" y="10" width="2" height="2" fill="#2980B9"/>
        </g>
    </g>

    <!-- ユーザー -->
    <g id="user">
        <circle cx="500" cy="260" r="60" fill="url(#userGradient)" stroke="#27AE60" stroke-width="3"/>
        <text x="500" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">ユーザー</text>

        <!-- ユーザーアイコン -->
        <g transform="translate(500, 270)">
            <circle cx="0" cy="-10" r="8" fill="white"/>
            <path d="M -12 8 Q -12 0 0 0 Q 12 0 12 8 Z" fill="white"/>
        </g>
    </g>

    <!-- RP群 (Relying Party) -->
    <g id="rp-group">
        <!-- RP1 -->
        <rect x="750" y="150" width="120" height="80" rx="8" fill="url(#rpGradient)" stroke="#E67E22" stroke-width="2"/>
        <text x="810" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">サービスA</text>
        <text x="810" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">ID: user_a123</text>

        <!-- RP2 -->
        <rect x="750" y="250" width="120" height="80" rx="8" fill="url(#rpGradient)" stroke="#E67E22" stroke-width="2"/>
        <text x="810" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">サービスB</text>
        <text x="810" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">ID: user_b456</text>

        <!-- RP3 -->
        <rect x="750" y="350" width="120" height="80" rx="8" fill="url(#rpGradient)" stroke="#E67E22" stroke-width="2"/>
        <text x="810" y="375" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">サービスC</text>
        <text x="810" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">ID: user_c789</text>
    </g>

    <!-- プライバシー保護レイヤー -->
    <ellipse cx="500" cy="260" rx="200" ry="150" fill="url(#privacyGradient)" opacity="0.3" stroke="#50E3C2" stroke-width="2" stroke-dasharray="5,5"/>

    <!-- データフロー矢印 -->
    <!-- IdP から ユーザー -->
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#34495E"/>
        </marker>
        <marker id="encrypted-arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#E74C3C"/>
        </marker>
    </defs>

    <!-- 認証フロー -->
    <path d="M 200 260 Q 350 200 440 260" fill="none" stroke="#3498DB" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="320" y="220" font-family="Arial, sans-serif" font-size="12" fill="#2980B9">認証・最小権限</text>

    <!-- ユーザーからRPへ（選択的開示） -->
    <path d="M 560 220 Q 650 180 750 190" fill="none" stroke="#E74C3C" stroke-width="2" marker-end="url(#encrypted-arrowhead)"/>
    <text x="640" y="170" font-family="Arial, sans-serif" font-size="12" fill="#E74C3C">選択的開示</text>

    <path d="M 560 260 Q 650 260 750 290" fill="none" stroke="#E74C3C" stroke-width="2" marker-end="url(#encrypted-arrowhead)"/>
    <text x="640" y="250" font-family="Arial, sans-serif" font-size="12" fill="#E74C3C">暗号化トークン</text>

    <path d="M 560 300 Q 650 340 750 390" fill="none" stroke="#E74C3C" stroke-width="2" marker-end="url(#encrypted-arrowhead)"/>
    <text x="640" y="360" font-family="Arial, sans-serif" font-size="12" fill="#E74C3C">PPID</text>

    <!-- プライバシー強化機能アイコン群 -->
    <g id="privacy-features">
        <!-- 最小権限の盾 -->
        <g transform="translate(300, 350)">
            <path d="M 0 -15 L -10 -5 L -10 10 L 0 20 L 10 10 L 10 -5 Z" fill="#27AE60" stroke="#1E8449" stroke-width="1"/>
            <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">最小権限</text>
            <circle cx="0" cy="0" r="3" fill="white"/>
        </g>

        <!-- 選択的開示のフィルター -->
        <g transform="translate(600, 120)">
            <rect x="-15" y="-8" width="30" height="16" rx="3" fill="#3498DB" stroke="#2980B9" stroke-width="1"/>
            <circle cx="-8" cy="0" r="2" fill="white"/>
            <circle cx="0" cy="0" r="2" fill="white"/>
            <circle cx="8" cy="0" r="2" fill="#E74C3C"/>
            <text x="0" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">選択フィルター</text>
        </g>

        <!-- 暗号化ロック -->
        <g transform="translate(400, 400)">
            <rect x="-8" y="-5" width="16" height="12" rx="2" fill="#E74C3C" stroke="#C0392B" stroke-width="1"/>
            <circle cx="0" cy="-8" r="5" fill="none" stroke="#E74C3C" stroke-width="2"/>
            <text x="0" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">暗号化</text>
        </g>

        <!-- ゼロ知識証明 -->
        <g transform="translate(550, 400)">
            <polygon points="0,-10 -8,5 8,5" fill="#9B59B6" stroke="#8E44AD" stroke-width="1"/>
            <circle cx="0" cy="-2" r="2" fill="white"/>
            <text x="0" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">ゼロ知識証明</text>
        </g>
    </g>

    <!-- ブラウザプライバシー保護 -->
    <g id="browser-privacy" transform="translate(500, 450)">
        <rect x="-80" y="-20" width="160" height="40" rx="20" fill="#34495E" stroke="#2C3E50" stroke-width="2"/>
        <text x="0" y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">ブラウザプライバシー保護</text>
        <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BDC3C7">ITP, SameSite Cookie</text>
    </g>

    <!-- 説明ボックス -->
    <g id="explanation">
        <rect x="50" y="500" width="900" height="150" rx="10" fill="white" stroke="#BDC3C7" stroke-width="1" opacity="0.95"/>
        <text x="70" y="530" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2C3E50">プライバシー強化技術の特徴</text>

        <text x="70" y="555" font-family="Arial, sans-serif" font-size="12" fill="#34495E">• 最小権限の原則: 必要最小限のスコープとデータのみを要求・提供</text>
        <text x="70" y="575" font-family="Arial, sans-serif" font-size="12" fill="#34495E">• 選択的開示: ユーザーが開示する情報を細かく制御（年齢証明のみなど）</text>
        <text x="70" y="595" font-family="Arial, sans-serif" font-size="12" fill="#34495E">• PPID: サービスごとに異なるユーザー識別子で追跡を困難に</text>
        <text x="70" y="615" font-family="Arial, sans-serif" font-size="12" fill="#34495E">• トークン暗号化: IDトークン・アクセストークンの内容を暗号化（JWE）</text>
        <text x="70" y="635" font-family="Arial, sans-serif" font-size="12" fill="#34495E">• ゼロ知識証明: 属性値を明かすことなく特定の条件を満たすことを証明</text>
    </g>

    <!-- 警告マーク -->
    <g transform="translate(920, 120)">
        <circle cx="0" cy="0" r="15" fill="#F39C12" stroke="#E67E22" stroke-width="2"/>
        <text x="0" y="5" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">!</text>
        <text x="0" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E67E22">追跡防止</text>
    </g>
</svg>